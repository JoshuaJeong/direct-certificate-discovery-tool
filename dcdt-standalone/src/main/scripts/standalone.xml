<?xml version="1.0" encoding="UTF-8"?>
<project name="standalone"
    xmlns:dcdt="antlib:gov.hhs.onc.dcdt"
    xmlns:dcdt-standalone="antlib:gov.hhs.onc.dcdt.standalone">
    
    <description>Ant project for Direct Certificate Discovery Tool (DCDT) standalones.</description>
    
    <taskdef resource="net/sf/antcontrib/antlib.xml" classpath="${maven.classpath}"/>
    <taskdef file="${project.module.core.build.scriptSourceDirectory}/antlib.xml" uri="antlib:gov.hhs.onc.dcdt"/>
    <taskdef file="${project.module.standalone.build.scriptSourceDirectory}/antlib-standalone.xml" uri="antlib:gov.hhs.onc.dcdt.standalone"/>
    
    <target name="standalone-process-exec-files" description="Processes standalone executable file(s).">
        <!-- Making standalone build directories, if they do not exist -->
        <mkdir dir="${project.build.standaloneBinDirectory}"/>
        <mkdir dir="${project.build.standaloneLogDirectory}"/>
        <mkdir dir="${project.build.standaloneVarDirectory}"/>
        <for param="binFile">
            <fileset dir="${project.build.standaloneBinDirectory}">
                <include name="**/wrapper-*"/>
            </fileset>
            <sequential>
                <dcdt-standalone:process-exec-file file="@{binFile}" binary="true"/>
            </sequential>
        </for>
        <for param="execFile">
            <fileset dir="${project.build.standaloneBinDirectory}">
                <include name="**/*.bat"/>
                <include name="**/*.sh"/>
                <include name="**/${project.artifactId}"/>
            </fileset>
            <sequential>
                <dcdt-standalone:process-exec-file file="@{execFile}"/>
            </sequential>
        </for>
    </target>
    
    <target name="standalone-init" description="Initializes standalone variable(s).">
        <!-- Project build standalone directory variable(s) -->
        <var name="project.build.standaloneAssemblyDirectory" value="${project.build.directory}/${project.artifactId}"/>
        <var name="project.build.standaloneBinDirectory" value="${project.build.standaloneAssemblyDirectory}/bin"/>
        <var name="project.build.standaloneLogDirectory" value="${project.build.standaloneAssemblyDirectory}/log"/>
        <var name="project.build.standaloneVarDirectory" value="${project.build.standaloneAssemblyDirectory}/var"/>
        
        <!-- Project standalone module build standalone directory variable(s) -->
        <var name="project.module.standalone.build.standaloneBinSourceDirectory" value="${project.module.standalone.basedir}/src/bin"/>
        
        <!-- Project standalone module build standalone file variable(s) -->
        <var name="project.module.standalone.build.standaloneBinSourceFile"
            value="${project.module.standalone.build.standaloneBinSourceDirectory}/dcdt-standalone.sh"/>
    </target>
    
    <target name="standalone" description="Generates standalone assembly file(s)." depends="standalone-init,standalone-process-exec-files"/>
</project>
