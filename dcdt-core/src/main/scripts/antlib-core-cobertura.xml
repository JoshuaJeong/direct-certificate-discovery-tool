<?xml version="1.0" encoding="UTF-8"?>
<antlib
    xmlns:cobertura="antlib:net.sourceforge.cobertura.ant"
    xmlns:current="ant:current"
    xmlns:dcdt="antlib:gov.hhs.onc.dcdt.ant">
    
    <macrodef name="check" description="Performs checks against Cobertura results.">
        <attribute name="metadataFile"/>
        <attribute name="haltOnFailure" default="true"/>
        <attribute name="branchRate" default="0"/>
        <attribute name="lineRate" default="0"/>
        <attribute name="packageBranchRate" default="0"/>
        <attribute name="packageLineRate" default="0"/>
        <attribute name="totalBranchRate" default="0"/>
        <attribute name="totalLineRate" default="0"/>
        <element name="check-elements" optional="true" implicit="true"/>
        <sequential>
            <cobertura:check datafile="@{metadataFile}" haltonfailure="@{haltOnFailure}" branchrate="@{branchRate}" linerate="@{lineRate}"
                packagebranchrate="@{packageBranchRate}" packagelinerate="@{packageLineRate}" totalbranchrate="@{totalBranchRate}"
                totallinerate="@{totalLineRate}" taskname="cobertura-check">
                <check-elements/>
            </cobertura:check>
        </sequential>
    </macrodef>
    
    <macrodef name="report" description="Generates a Cobertura report.">
        <attribute name="metadataFile"/>
        <attribute name="srcDir"/>
        <attribute name="outDir"/>
        <attribute name="maxMemory" default="64M"/>
        <element name="report-elements" optional="true" implicit="true"/>
        <sequential>
            <cobertura:report datafile="@{metadataFile}" srcdir="@{srcDir}" destdir="@{outDir}" maxmemory="@{maxMemory}" taskname="cobertura-report">
                <report-elements/>
            </cobertura:report>
        </sequential>
    </macrodef>
    
    <macrodef name="merge" description="Merges Cobertura metadata files.">
        <attribute name="metadataFile"/>
        <attribute name="maxMemory" default="64M"/>
        <element name="merge-elements" optional="true" implicit="true"/>
        <sequential>
            <cobertura:merge datafile="@{metadataFile}" maxmemory="@{maxMemory}" taskname="cobertura-merge">
                <merge-elements/>
            </cobertura:merge>
        </sequential>
    </macrodef>
    
    <macrodef name="instrument" description="Generates Cobertura instrumented classes + metadata for the given class files.">
        <attribute name="metadataFile"/>
        <attribute name="outDir"/>
        <attribute name="maxMemory" default="64M"/>
        <element name="instrument-elements" optional="true" implicit="true"/>
        <sequential>
            <cobertura:instrument datafile="@{metadataFile}" todir="@{outDir}" maxmemory="@{maxMemory}" taskname="cobertura-instrument">
                <instrument-elements/>
            </cobertura:instrument>
        </sequential>
    </macrodef>
</antlib>