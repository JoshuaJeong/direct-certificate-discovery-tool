<?xml version="1.0" encoding="UTF-8"?>
<project name="archive"
    xmlns:dcdt="antlib:gov.hhs.onc.dcdt.ant"
    xmlns:dcdt-archive="antlib:gov.hhs.onc.dcdt.ant.archive">
    
    <description>Ant project for Direct Certificate Discovery Tool (DCDT) archives.</description>
    
    <import file="${project.basedir.all}/dcdt-core/src/main/scripts/ant-core.xml" as="" prefixSeparator=""/>
    
    <taskdef file="${project.basedir.all}/dcdt-core/src/main/scripts/antlib-archive.xml" uri="antlib:gov.hhs.onc.dcdt.ant.archive"/>
    
    <target name="archive-process-props" description="Processes Maven archive project properties.">
        <dcdt:dirname path="${project.build.archivePomPropertiesFile}" property="project.build.archivePomPropertiesDir"/>
        <mkdir dir="${project.build.archivePomPropertiesDir}"/>
        
        <propertyselector property="project.archive.pom.props.build" override="true"
            match="^project\.module\.[^\.]+\.build\.timestamp$"/>
        <propertyselector property="project.archive.pom.props.hg" override="true"
            match="^project\.module\.[^\.]+\.hg\.(?:author(?:\.(?:email|person))?|branch|date|node(?:\.short)?|rev|tag)$"/>
        <dcdt:write-properties file="${project.build.archivePomPropertiesFile}" append="true">
            project.module.${project.artifactId}.groupId=${project.groupId},
            project.module.${project.artifactId}.artifactId=${project.artifactId},
            project.module.${project.artifactId}.version=${project.version},
            ${project.archive.pom.props.build},
            ${project.archive.pom.props.hg}
        </dcdt:write-properties>
    </target>
    
    <target name="archive-init" description="Initializes archive variable(s).">
        <var name="project.build.archivePomPropertiesFile"
            value="${project.build.outputDirectory}/META-INF/maven/${project.groupId}/${project.artifactId}/pom-archive.properties"/>
    </target>
    
    <target name="archive" description="Prepares archive file(s)." depends="core,archive-init,archive-process-props"/>
</project>
