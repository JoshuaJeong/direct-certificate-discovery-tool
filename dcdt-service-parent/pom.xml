<project
    xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    
    <modelVersion>4.0.0</modelVersion>
    
    <parent>
        <groupId>gov.hhs.onc.dcdt</groupId>
        <artifactId>dcdt-parent</artifactId>
        <version>3.0-SNAPSHOT</version>
        <relativePath>../dcdt-parent</relativePath>
    </parent>
    
    <artifactId>dcdt-service-parent</artifactId>
    <packaging>pom</packaging>
    
    <name>dcdt-service-parent</name>
    <description>Direct Certificate Discovery Tool (DCDT) service parent project.</description>
    <url>http://api.direct-test.com/${project.artifactId}/${project.version}/</url>
    
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.apache.camel</groupId>
                <artifactId>camel-spring</artifactId>
                <version>2.11.1</version>
            </dependency>
            <dependency>
                <groupId>org.apache.directory.server</groupId>
                <artifactId>apacheds-core</artifactId>
                <version>2.0.0-M15</version>
                <exclusions>
                    <exclusion>
                        <groupId>org.apache.directory.api</groupId>
                        <artifactId>api-ldap-schema-data</artifactId>
                    </exclusion>
                </exclusions>
            </dependency>
            <dependency>
                <groupId>org.apache.directory.server</groupId>
                <artifactId>apacheds-core-annotations</artifactId>
                <version>2.0.0-M15</version>
                <exclusions>
                    <exclusion>
                        <groupId>log4j</groupId>
                        <artifactId>log4j</artifactId>
                    </exclusion>
                    <exclusion>
                        <groupId>org.apache.directory.api</groupId>
                        <artifactId>api-ldap-schema-data</artifactId>
                    </exclusion>
                    <exclusion>
                        <groupId>org.apache.directory.jdbm</groupId>
                        <artifactId>apacheds-jdbm1</artifactId>
                    </exclusion>
                    <exclusion>
                        <groupId>org.slf4j</groupId>
                        <artifactId>slf4j-log4j12</artifactId>
                    </exclusion>
                </exclusions>
            </dependency>
            <dependency>
                <groupId>org.apache.directory.server</groupId>
                <artifactId>apacheds-server-annotations</artifactId>
                <version>2.0.0-M15</version>
                <exclusions>
                    <exclusion>
                        <groupId>org.apache.directory.api</groupId>
                        <artifactId>api-ldap-schema-data</artifactId>
                    </exclusion>
                    <exclusion>
                        <groupId>org.apache.directory.jdbm</groupId>
                        <artifactId>apacheds-jdbm1</artifactId>
                    </exclusion>
                </exclusions>
            </dependency>
            <dependency>
                <groupId>org.apache.james</groupId>
                <artifactId>apache-james</artifactId>
                <version>3.0-beta4</version>
                <exclusions>
                    <exclusion>
                        <groupId>log4j</groupId>
                        <artifactId>log4j</artifactId>
                    </exclusion>
                    <exclusion>
                        <groupId>org.slf4j</groupId>
                        <artifactId>slf4j-log4j12</artifactId>
                    </exclusion>
                </exclusions>
            </dependency>
            <dependency>
                <groupId>org.apache.james</groupId>
                <artifactId>james-server-queue-activemq</artifactId>
                <version>3.0-beta4</version>
            </dependency>
            <dependency>
                <groupId>tanukisoft</groupId>
                <artifactId>wrapper</artifactId>
                <version>3.2.3</version>
                <scope>provided</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>
    
    <build>
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-antrun-plugin</artifactId>
                    <inherited>true</inherited>
                    <executions>
                        <!-- Preparing service assembly file(s) -->
                        <execution>
                            <id>prepare-service</id>
                            <phase>prepare-package</phase>
                            <goals>
                                <goal>run</goal>
                            </goals>
                            <inherited>true</inherited>
                            <configuration>
                                <target>
                                    <ant antfile="${project.basedir}/../dcdt-service-core/src/main/scripts/ant-service.xml" target="service" inheritRefs="true"/>
                                </target>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-assembly-plugin</artifactId>
                    <inherited>true</inherited>
                    <executions>
                        <!-- Building service assembly -->
                        <execution>
                            <id>assembly-service</id>
                            <phase>package</phase>
                            <goals>
                                <goal>single</goal>
                            </goals>
                            <inherited>true</inherited>
                            <configuration>
                                <descriptors>
                                    <descriptor>${project.basedir}/../dcdt-service-core/src/assembly/service.xml</descriptor>
                                </descriptors>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-dependency-plugin</artifactId>
                    <inherited>true</inherited>
                    <executions>
                        <!-- Copying service dependencies -->
                        <execution>
                            <id>copy-dependencies-service</id>
                            <phase>generate-resources</phase>
                            <goals>
                                <goal>copy-dependencies</goal>
                            </goals>
                            <inherited>true</inherited>
                            <configuration>
                                <includeScope>runtime</includeScope>
                                <outputDirectory>${project.build.directory}/${project.artifactId}/lib</outputDirectory>
                            </configuration>
                        </execution>
                        <!-- Unpacking dependency service resources -->
                        <execution>
                            <id>unpack-dependency-resources-service</id>
                            <phase>generate-resources</phase>
                            <goals>
                                <goal>unpack</goal>
                            </goals>
                            <inherited>true</inherited>
                            <configuration>
                                <artifactItems>
                                    <artifactItem>
                                        <groupId>${project.groupId}</groupId>
                                        <artifactId>dcdt-core</artifactId>
                                        <version>${project.version}</version>
                                    </artifactItem>
                                    <artifactItem>
                                        <groupId>${project.groupId}</groupId>
                                        <artifactId>dcdt-service-core</artifactId>
                                        <version>${project.version}</version>
                                    </artifactItem>
                                </artifactItems>
                                <includes>META-INF/core/**,META-INF/logback/**,META-INF/service/**,META-INF/spring/**</includes>
                                <excludes>META-INF/spring/**/*service*-embedded.xml</excludes>
                                <outputDirectory>${project.build.directory}/${project.artifactId}-dependency-resources</outputDirectory>
                            </configuration>
                        </execution>
                        <!-- Unpacking test dependency service resources -->
                        <execution>
                            <id>unpack-test-dependency-resources-service</id>
                            <phase>generate-test-resources</phase>
                            <goals>
                                <goal>unpack</goal>
                            </goals>
                            <inherited>true</inherited>
                            <configuration>
                                <artifactItems>
                                    <artifactItem>
                                        <groupId>${project.groupId}</groupId>
                                        <artifactId>dcdt-core</artifactId>
                                        <version>${project.version}</version>
                                        <type>test-jar</type>
                                    </artifactItem>
                                    <artifactItem>
                                        <groupId>${project.groupId}</groupId>
                                        <artifactId>dcdt-service-core</artifactId>
                                        <version>${project.version}</version>
                                        <type>test-jar</type>
                                    </artifactItem>
                                </artifactItems>
                                <includes>META-INF/core/**,META-INF/logback/**,META-INF/service/**,META-INF/spring/**,META-INF/test/**</includes>
                                <excludes>META-INF/spring/**/*service*-embedded.xml</excludes>
                                <outputDirectory>${project.build.directory}/${project.artifactId}-test-dependency-resources</outputDirectory>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-jar-plugin</artifactId>
                    <executions>
                        <execution>
                            <id>default-jar</id>
                            <configuration>
                                <outputDirectory>${project.build.directory}/${project.artifactId}/lib</outputDirectory>
                            </configuration>
                        </execution>
                        <execution>
                            <id>test-jar</id>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-resources-plugin</artifactId>
                    <inherited>true</inherited>
                    <executions>
                        <!-- Copying service resources -->
                        <execution>
                            <id>copy-resources-service</id>
                            <phase>process-resources</phase>
                            <goals>
                                <goal>copy-resources</goal>
                            </goals>
                            <inherited>true</inherited>
                            <configuration>
                                <outputDirectory>${project.build.directory}/${project.artifactId}</outputDirectory>
                                <resources>
                                    <!-- Executable file(s) (project) -->
                                    <resource>
                                        <directory>${project.basedir}/src/bin</directory>
                                        <filtering>true</filtering>
                                        <includes>
                                            <include>**/*.bat</include>
                                            <include>**/*.sh</include>
                                        </includes>
                                        <targetPath>bin</targetPath>
                                    </resource>
                                    <resource>
                                        <directory>${project.basedir}/src/bin</directory>
                                        <excludes>
                                            <exclude>**/*.bat</exclude>
                                            <exclude>**/*.sh</exclude>
                                        </excludes>
                                        <targetPath>bin</targetPath>
                                    </resource>
                                    <!-- Executable file(s) (daemons) -->
                                    <resource>
                                        <directory>${project.build.directory}/${project.artifactId}-daemons/jsw/${project.artifactId}/bin</directory>
                                        <filtering>true</filtering>
                                        <includes>
                                            <include>**/*.bat</include>
                                            <include>**/*.sh</include>
                                            <include>**/${project.artifactId}</include>
                                        </includes>
                                        <targetPath>bin</targetPath>
                                    </resource>
                                    <resource>
                                        <directory>${project.build.directory}/${project.artifactId}-daemons/jsw/${project.artifactId}/bin</directory>
                                        <excludes>
                                            <exclude>**/*.bat</exclude>
                                            <exclude>**/*.sh</exclude>
                                            <exclude>**/${project.artifactId}</exclude>
                                        </excludes>
                                        <targetPath>bin</targetPath>
                                    </resource>
                                    <!-- Configuration file(s) (dependencies) -->
                                    <resource>
                                        <directory>${project.build.directory}/${project.artifactId}-dependency-resources/META-INF</directory>
                                        <filtering>true</filtering>
                                        <includes>
                                            <include>**/*.conf</include>
                                            <include>**/*.properties</include>
                                            <include>**/*.xml</include>
                                        </includes>
                                        <targetPath>conf</targetPath>
                                    </resource>
                                    <resource>
                                        <directory>${project.build.directory}/${project.artifactId}-dependency-resources/META-INF</directory>
                                        <excludes>
                                            <exclude>**/*.conf</exclude>
                                            <exclude>**/*.properties</exclude>
                                            <exclude>**/*.xml</exclude>
                                        </excludes>
                                        <targetPath>conf</targetPath>
                                    </resource>
                                    <!-- Configuration file(s) (project) -->
                                    <resource>
                                        <directory>${project.build.resourcesDirectory}/META-INF</directory>
                                        <filtering>true</filtering>
                                        <includes>
                                            <include>**/*.conf</include>
                                            <include>**/*.properties</include>
                                            <include>**/*.xml</include>
                                        </includes>
                                        <excludes>
                                            <exclude>spring/**/*service*-embedded.xml</exclude>
                                        </excludes>
                                        <targetPath>conf</targetPath>
                                    </resource>
                                    <resource>
                                        <directory>${project.build.resourcesDirectory}/META-INF</directory>
                                        <excludes>
                                            <exclude>**/*.conf</exclude>
                                            <exclude>**/*.properties</exclude>
                                            <exclude>**/*.xml</exclude>
                                        </excludes>
                                        <targetPath>conf</targetPath>
                                    </resource>
                                    <!-- Configuration file(s) (daemons) -->
                                    <resource>
                                        <directory>${project.build.directory}/${project.artifactId}-daemons/jsw/${project.artifactId}/conf</directory>
                                        <filtering>true</filtering>
                                        <includes>
                                            <include>**/*.conf</include>
                                            <include>**/*.properties</include>
                                            <include>**/*.xml</include>
                                        </includes>
                                        <targetPath>conf</targetPath>
                                    </resource>
                                    <resource>
                                        <directory>${project.build.directory}/${project.artifactId}-daemons/jsw/${project.artifactId}/conf</directory>
                                        <excludes>
                                            <exclude>**/*.conf</exclude>
                                            <exclude>**/*.properties</exclude>
                                            <exclude>**/*.xml</exclude>
                                        </excludes>
                                        <targetPath>conf</targetPath>
                                    </resource>
                                    <!-- Library file(s) (daemons) -->
                                    <resource>
                                        <directory>${project.build.directory}/${project.artifactId}-daemons/jsw/${project.artifactId}/lib</directory>
                                        <targetPath>lib</targetPath>
                                    </resource>
                                </resources>
                            </configuration>
                        </execution>
                        <!-- Copying test service resources -->
                        <execution>
                            <id>copy-test-resources-service</id>
                            <phase>process-test-resources</phase>
                            <goals>
                                <goal>copy-resources</goal>
                            </goals>
                            <inherited>true</inherited>
                            <configuration>
                                <outputDirectory>${project.build.directory}/${project.artifactId}-test</outputDirectory>
                                <resources>
                                    <!-- Test configuration file(s) (dependencies) -->
                                    <resource>
                                        <directory>${project.build.directory}/${project.artifactId}-test-dependency-resources/META-INF</directory>
                                        <filtering>true</filtering>
                                        <includes>
                                            <include>**/*.conf</include>
                                            <include>**/*.properties</include>
                                            <include>**/*.xml</include>
                                        </includes>
                                        <targetPath>conf</targetPath>
                                    </resource>
                                    <resource>
                                        <directory>${project.build.directory}/${project.artifactId}-test-dependency-resources/META-INF</directory>
                                        <excludes>
                                            <exclude>**/*.conf</exclude>
                                            <exclude>**/*.properties</exclude>
                                            <exclude>**/*.xml</exclude>
                                        </excludes>
                                        <targetPath>conf</targetPath>
                                    </resource>
                                    <!-- Test configuration file(s) (project) -->
                                    <resource>
                                        <directory>${project.build.testResourcesDirectory}/META-INF</directory>
                                        <filtering>true</filtering>
                                        <includes>
                                            <include>**/*.conf</include>
                                            <include>**/*.properties</include>
                                            <include>**/*.xml</include>
                                        </includes>
                                        <excludes>
                                            <exclude>spring/**/*service*-embedded.xml</exclude>
                                        </excludes>
                                        <targetPath>conf</targetPath>
                                    </resource>
                                    <resource>
                                        <directory>${project.build.testResourcesDirectory}/META-INF</directory>
                                        <excludes>
                                            <exclude>**/*.conf</exclude>
                                            <exclude>**/*.properties</exclude>
                                            <exclude>**/*.xml</exclude>
                                        </excludes>
                                        <targetPath>conf</targetPath>
                                    </resource>
                                </resources>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-surefire-plugin</artifactId>
                    <configuration>
                        <additionalClasspathElements>
                            <additionalClasspathElement>${project.build.directory}/${project.artifactId}/conf</additionalClasspathElement>
                            <additionalClasspathElement>${project.build.directory}/${project.artifactId}-test/conf</additionalClasspathElement>
                        </additionalClasspathElements>
                        <basedir>${project.build.directory}/${project.artifactId}</basedir>
                        <systemPropertyVariables>
                            <dcdt.log.dir>log</dcdt.log.dir>
                            <spring.profiles.active>${project.service.standalone.spring.profiles.active}</spring.profiles.active>
                        </systemPropertyVariables>
                    </configuration>
                    <executions>
                        <execution>
                            <id>test-unit</id>
                        </execution>
                        <execution>
                            <id>test-functional</id>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>org.codehaus.mojo</groupId>
                    <artifactId>appassembler-maven-plugin</artifactId>
                    <inherited>true</inherited>
                    <executions>
                        <!-- Building service daemons -->
                        <execution>
                            <id>daemons-service</id>
                            <phase>generate-resources</phase>
                            <goals>
                                <goal>generate-daemons</goal>
                            </goals>
                            <inherited>true</inherited>
                            <configuration>
                                <daemons>
                                    <daemon>
                                        <id>${project.artifactId}</id>
                                        <mainClass>${project.service.standalone.java.class.main}</mainClass>
                                        <commandLineArguments>
                                            <commandLineArgument>start</commandLineArgument>
                                        </commandLineArguments>
                                        <platforms>
                                            <platform>jsw</platform>
                                        </platforms>
                                        <generatorConfigurations>
                                            <generatorConfiguration>
                                                <generator>jsw</generator>
                                                <includes>
                                                    <include>linux-x86-32</include>
                                                    <include>linux-x86-64</include>
                                                    <include>windows-x86-32</include>
                                                    <include>windows-x86-64</include>
                                                </includes>
                                                <configuration combine.children="append">
                                                    <property>
                                                        <name>configuration.directory.in.classpath.first</name>
                                                        <value>conf</value>
                                                    </property>
                                                    <property>
                                                        <name>set.APP_BASE</name>
                                                        <value>..</value>
                                                    </property>
                                                    <property>
                                                        <name>set.default.APP_LONG_NAME</name>
                                                        <value>${project.service.name.display}</value>
                                                    </property>
                                                    <property>
                                                        <name>set.default.APP_NAME</name>
                                                        <value>${project.service.name}</value>
                                                    </property>
                                                    <property>
                                                        <name>set.default.REPO_DIR</name>
                                                        <value>lib</value>
                                                    </property>
                                                    <property>
                                                        <name>set.LD_PRELOAD</name>
                                                        <value>/usr/lib/authbind/libauthbind.so.1</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.console.format</name>
                                                        <value>M</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.description</name>
                                                        <value>${project.service.description}</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.displayname</name>
                                                        <value>${project.service.name.display}</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.java.additional.1</name>
                                                        <value>-XX:PermSize=64m</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.java.additional.2</name>
                                                        <value>-XX:MaxPermSize=128m</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.java.additional.3</name>
                                                        <value>-XX:+UseConcMarkSweepGC</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.java.additional.4</name>
                                                        <value>-XX:+CMSClassUnloadingEnabled</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.java.additional.5</name>
                                                        <value>-Djava.net.preferIPv4Stack=true</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.java.additional.6</name>
                                                        <value>-Djava.security.manager</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.java.additional.7</name>
                                                        <value>-Djava.security.policy=conf/service/wrapper-service.policy</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.java.additional.8</name>
                                                        <value>-Dlogback.configurationFile=${project.logback.config.file}</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.java.additional.9</name>
                                                        <value>-Dspring.profiles.active=${project.service.standalone.spring.profiles.active}</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.java.additional.10</name>
                                                        <value>-Ddcdt.log.dir=log</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.logfile</name>
                                                        <value>log/wrapper-${project.service.name}.log</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.name</name>
                                                        <value>${project.service.name}</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.ntservice.description</name>
                                                        <value>${project.service.description}</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.ntservice.displayname</name>
                                                        <value>${project.service.name.display}</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.ntservice.name</name>
                                                        <value>${project.service.name}</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.pidfile</name>
                                                        <value>../var</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.pidfile.strict</name>
                                                        <value>true</value>
                                                    </property>
                                                    <property>
                                                        <name>wrapper.statusfile</name>
                                                        <value>var/${project.service.name}.status</value>
                                                    </property>
                                                </configuration>
                                            </generatorConfiguration>
                                        </generatorConfigurations>
                                    </daemon>
                                </daemons>
                                <defaultJvmSettings>
                                    <initialMemorySize>128M</initialMemorySize>
                                    <maxMemorySize>256M</maxMemorySize>
                                </defaultJvmSettings>
                                <target>${project.build.directory}/${project.artifactId}-daemons</target>
                                <useWildcardClassPath>true</useWildcardClassPath>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>org.kuali.maven.plugins</groupId>
                    <artifactId>properties-maven-plugin</artifactId>
                    <inherited>true</inherited>
                    <executions>
                        <!-- Reading service Maven POM properties files -->
                        <execution>
                            <id>read-pom-properties</id>
                            <inherited>true</inherited>
                            <configuration>
                                <locations combine.self="override">
                                    <location>${project.basedir}/../dcdt-parent/target/maven/pom.properties</location>
                                    <location>${project.basedir}/${project.parent.relativePath}/target/maven/pom.properties</location>
                                    <location>${project.build.directory}/maven/pom.properties</location>
                                </locations>
                            </configuration>
                        </execution>
                        <execution>
                            <id>translate-pom-properties</id>
                        </execution>
                    </executions>
                </plugin>
            </plugins>
        </pluginManagement>
        
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-antrun-plugin</artifactId>
                <inherited>false</inherited>
                <executions>
                    <execution>
                        <id>prepare-project</id>
                        <inherited>false</inherited>
                    </execution>
                    <execution>
                        <id>prepare-archive</id>
                        <inherited>false</inherited>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>