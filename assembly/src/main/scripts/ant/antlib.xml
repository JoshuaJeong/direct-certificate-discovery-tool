<?xml version="1.0" encoding="UTF-8"?>
<antlib xmlns:current="ant:current">
	<!-- Variable preset definitions -->
	<presetdef name="true">
		<var value="true"/>
	</presetdef>
	<presetdef name="false">
		<var value="false"/>
	</presetdef>
	<presetdef name="unset">
		<var unset="true"/>
	</presetdef>
	
	<!-- Logging property preset definitions -->
	<presetdef name="trace">
		<echo level="trace" taskname="trace"/>
	</presetdef>
	<presetdef name="debug">
		<echo level="debug" taskname="debug"/>
	</presetdef>
	<presetdef name="info">
		<echo level="info" taskname="info"/>
	</presetdef>
	<presetdef name="warn">
		<echo level="warn" taskname="warn"/>
	</presetdef>
	<presetdef name="error">
		<echo level="error" taskname="error"/>
	</presetdef>
		
	<macrodef name="appendproperty" description="Appends the value of a property, optionally using a delimiter.">
		<attribute name="delimiter" default=""/>
		<attribute name="property"/>
		<attribute name="value" default=""/>
		<text name="text" trim="true" optional="true"/>
		<sequential>
			<if>
				<and>
					<not><equals arg1="${@{property}}" arg2=""/></not>
					<not><equals arg1="${@{delimiter}}" arg2=""/></not>
				</and>
				<then>
					<var name="@{property}" value="${@{property}}@{delimiter}"/>
				</then>
			</if>
			<var name="@{property}" value="${@{property}}@{value}@{text}"/>
		</sequential>
	</macrodef>
	
	<macrodef name="webappproperties" description="Sets properties for a given webapp.">
		<attribute name="src"/>
		<attribute name="srcContext"/>
		<attribute name="baseProperty" default="@{srcContext}.build.tomcat.webapp.name"/>
		<attribute name="dirProperty" default="@{srcContext}.build.tomcat.webapp.dir"/>
		<attribute name="pkgDirProperty" default="package.build.tomcat.webapp.dir"/>
		<attribute name="warFileProperty" default="package.build.tomcat.webapp.war.file"/>
		<sequential>
			<current:unset name="@{baseProperty}"/>
			<basename property="@{baseProperty}" file="@{src}" suffix=".war"/>
			
			<if>
				<equals arg1="@{srcContext}" arg2="direct-project-stock"/>
				<then>
					<var name="@{dirProperty}" value="${@{srcContext}.build.tomcat.webapps.dir}/${@{baseProperty}}"/>
					<var name="@{pkgDirProperty}" value="${package.build.tomcat.webapps.dir}/${@{baseProperty}}"/>
				</then>
				<else>
					<var name="@{warFileProperty}" value="${package.build.tomcat.webapps.dir}/${@{baseProperty}}.war"/>
				</else>
			</if>
		</sequential>
	</macrodef>
</antlib>