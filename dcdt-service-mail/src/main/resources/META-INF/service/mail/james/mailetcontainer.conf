<?xml version="1.0" encoding="UTF-8"?>
<mailetcontainer enableJmx="true">
    <context>
        <postmaster>postmaster</postmaster>
    </context>
    <processors>
        <processor state="root" enableJmx="true">
            <mailet match="All" class="PostmasterAlias"/>
            <mailet match="RelayLimit=30" class="Null"/>
            <mailet match="SMTPAuthSuccessful" class="ToProcessor">
                <processor>transport</processor>
            </mailet>
            <mailet match="All" class="ToProcessor">
                <processor>transport</processor>
            </mailet>
        </processor>
        
        <processor state="error" enableJmx="true">
            <mailet match="All" class="ToRepository">
                <repositoryPath>memory:${dcdt.service.mail.james.repo.error}</repositoryPath>
            </mailet>
        </processor>
        
        <processor state="transport" enableJmx="true">
            <mailet match="SMTPAuthSuccessful" class="SetMimeHeader">
                <name>X-UserIsAuth</name>
                <value>true</value>
            </mailet>
            <mailet match="All" class="RecipientRewriteTable"/>
            <mailet match="RecipientIsLocal" class="ToSenderFolder">
                <folder>Sent</folder>
                <consume>false</consume>
            </mailet>
            <mailet match="RecipientIsLocal" class="LocalDelivery"/>
            <mailet match="HostIsLocal" class="ToProcessor">
                <processor>local-address-error</processor>
                <notice>550 - Requested action not taken: no such user here</notice>
            </mailet>
            <!--
            <mailet match="RemoteAddrNotInNetwork=127.0.0.1" class="ToProcessor">
                <processor>relay-denied</processor>
                <notice>550 - Requested action not taken: relaying denied</notice>
            </mailet>
            -->
            <mailet match="All" class="RemoteDelivery">
                <outgoingQueue>outgoing</outgoingQueue>
                <delayTime>5 minutes</delayTime>
                <delayTime>10 minutes</delayTime>
                <delayTime>45 minutes</delayTime>
                <delayTime>2 hours</delayTime>
                <delayTime>3 hours</delayTime>
                <delayTime>6 hours</delayTime>
                <maxRetries>25</maxRetries>
                <maxDnsProblemRetries>0</maxDnsProblemRetries>
                <deliveryThreads>10</deliveryThreads>
                <sendpartial>true</sendpartial>
                <bounceProcessor>bounces</bounceProcessor>
            </mailet>
        </processor>
        
        <processor state="local-address-error" enableJmx="true">
            <mailet match="All" class="ToRepository">
                <repositoryPath>memory:${dcdt.service.mail.james.repo.error.addr}</repositoryPath>
            </mailet>
        </processor>
        
        <processor state="relay-denied" enableJmx="true">
            <mailet match="All" class="ToRepository">
                <repositoryPath>memory:${dcdt.service.mail.james.repo.error.relay}</repositoryPath>
            </mailet>
        </processor>
        
        <processor state="bounces" enableJmx="true">
            <mailet match="All" class="DSNBounce">
                <passThrough>false</passThrough>
            </mailet>
        </processor>
    </processors>
    <spooler>
        <threads>20</threads>
    </spooler>
</mailetcontainer>